<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volleybal Rotatiebord</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            display: flex;
            flex-direction: row;
            height: 100vh;
            overflow: hidden;
        }

        .controls {
            background: white;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            justify-content: center;
            border-left: 2px solid #ddd;
            flex-shrink: 0;
            order: 2;
        }

        button {
            padding: 15px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 24px;
            transition: background 0.3s;
            min-width: 60px;
            min-height: 60px;
            touch-action: manipulation;
        }

        button:hover {
            background: #2980b9;
        }

        .court-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            min-height: 0;
            min-width: 0;
            order: 1;
        }

        .court {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: min(900px, 150vh);
            max-height: min(600px, 66.67vw);
            aspect-ratio: 3 / 2;
            background: #f4e8d0;
            border: 3px solid #333;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
        }

        @media (max-width: 768px) {
            .court-container {
                padding: 5px;
            }
        }

        @media (orientation: landscape) {
            .controls {
                padding: 10px;
                gap: 12px;
            }

            button {
                min-width: 50px;
                min-height: 50px;
                font-size: 20px;
                padding: 12px 20px;
            }
        }

        @media (orientation: portrait) {
            body {
                flex-direction: column;
            }

            .controls {
                flex-direction: row;
                border-left: none;
                border-bottom: 2px solid #ddd;
                order: 1;
            }

            .court-container {
                order: 2;
            }
        }

        .zone {
            border: 1px solid rgba(0, 0, 0, 0.2);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zone-label {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: clamp(14px, 3vw, 18px);
            color: rgba(0, 0, 0, 0.3);
            font-weight: bold;
            pointer-events: none;
        }

        .player-chip {
            position: absolute;
            width: clamp(45px, 8vw, 60px);
            height: clamp(45px, 8vw, 60px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: move;
            user-select: none;
            transition: left 0.5s ease-in-out, top 0.5s ease-in-out, transform 0.2s;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            color: white;
            font-size: clamp(14px, 3vw, 18px);
            touch-action: none;
        }

        .player-chip.dragging {
            transform: scale(1.1);
            z-index: 100;
            opacity: 0.9;
            transition: transform 0.2s;
        }

        .player-chip.fault {
            animation: glow 1s ease-in-out infinite;
        }

        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 10px 5px rgba(255, 0, 0, 0.5);
            }

            50% {
                box-shadow: 0 0 20px 10px rgba(255, 0, 0, 0.8);
            }
        }

        /* Toggle switch */
        .toggle-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .toggle-label {
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle-switch input:checked+.toggle-slider {
            background-color: #3498db;
        }

        .toggle-switch input:checked+.toggle-slider:before {
            transform: translateX(26px);
        }

        /* Preset buttons */
        .preset-container {
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        @media (orientation: portrait) {
            .preset-container {
                flex-direction: row;
            }
        }

        .preset-btn {
            position: relative;
            background: #8e44ad;
            min-width: 50px;
            min-height: 50px;
            font-size: 20px;
            padding: 12px 20px;
        }

        .preset-btn:hover {
            background: #732d91;
        }

        .preset-btn::after {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #27ae60;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .preset-btn.filled::after {
            opacity: 1;
        }

        .preset-btn.saving {
            animation: save-pulse 0.5s ease-out;
        }

        @keyframes save-pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.15);
                background: #27ae60;
            }

            100% {
                transform: scale(1);
            }
        }
    </style>
</head>

<body>
    <div class="controls">
        <button onclick="rotate('ccw')" title="Roteer linksom">←</button>
        <button onclick="rotate('cw')" title="Roteer rechtsom">→</button>
        <button onclick="resetPositions()" title="Herstel posities">↺</button>
        <button onclick="toggleFullscreen()" id="fullscreen-btn" title="Volledig scherm">⛶</button>
        <div class="toggle-container">
            <span class="toggle-label">Foutcheck</span>
            <label class="toggle-switch">
                <input type="checkbox" id="rotation-check" onchange="toggleRotationCheck()">
                <span class="toggle-slider"></span>
            </label>
        </div>
        <div class="preset-container">
            <button class="preset-btn" id="preset-1" data-slot="0"
                title="Klik om te laden, houd vast om op te slaan">1</button>
            <button class="preset-btn" id="preset-2" data-slot="1"
                title="Klik om te laden, houd vast om op te slaan">2</button>
            <button class="preset-btn" id="preset-3" data-slot="2"
                title="Klik om te laden, houd vast om op te slaan">3</button>
        </div>
    </div>

    <div class="court-container">
        <div class="court" id="court">
            <div class="zone" data-zone="4">
                <div class="zone-label">4</div>
            </div>
            <div class="zone" data-zone="3">
                <div class="zone-label">3</div>
            </div>
            <div class="zone" data-zone="2">
                <div class="zone-label">2</div>
            </div>
            <div class="zone" data-zone="5">
                <div class="zone-label">5</div>
            </div>
            <div class="zone" data-zone="6">
                <div class="zone-label">6</div>
            </div>
            <div class="zone" data-zone="1">
                <div class="zone-label">1</div>
            </div>
        </div>
    </div>

    <script>
        // Player data with colors and positions
        const players = [
            { id: 'SV', label: 'SV', color: '#3498db', zone: 1 },    // Spelverdeler (Setter) - blue
            { id: 'PL1', label: 'PL1', color: '#27ae60', zone: 2 },  // Passer-loper 1 (Outside Hitter 1) - green
            { id: 'M1', label: 'M1', color: '#e74c3c', zone: 3 },    // Middenblokeerder 1 (Middle Blocker 1) - red
            { id: 'D', label: 'D', color: '#f39c12', zone: 4 },      // Diagonaal (Opposite) - yellow
            { id: 'PL2', label: 'PL2', color: '#27ae60', zone: 5 },  // Passer-loper 2 (Outside Hitter 2) - green
            { id: 'M2', label: 'M2', color: '#e74c3c', zone: 6 }     // Middenblokeerder 2 (Middle Blocker 2) - red
        ];

        let draggedPlayer = null;
        let playerPositions = {};
        let rotationCheckEnabled = true;
        let presets = [null, null, null];
        let pressTimer = null;

        // Initialize
        function init() {
            createPlayerChips();
            snapToZones();
            loadPresets();
            initPresetButtons();
        }

        // Create player chips on court
        function createPlayerChips() {
            const court = document.getElementById('court');

            players.forEach(player => {
                const chip = document.createElement('div');
                chip.className = 'player-chip';
                chip.id = `chip-${player.id}`;
                chip.style.backgroundColor = player.color;
                chip.textContent = player.label;
                chip.draggable = true;

                chip.addEventListener('dragstart', handleDragStart);
                chip.addEventListener('dragend', handleDragEnd);

                // Touch support
                chip.addEventListener('touchstart', handleTouchStart, { passive: false });
                chip.addEventListener('touchmove', handleTouchMove, { passive: false });
                chip.addEventListener('touchend', handleTouchEnd, { passive: false });

                court.appendChild(chip);

                // Store initial position
                playerPositions[player.id] = {
                    zone: player.zone,
                    x: 0,
                    y: 0
                };
            });

            // Setup court for drop
            court.addEventListener('dragover', handleDragOver);
            court.addEventListener('drop', handleDrop);
        }

        // Drag and drop handlers
        function handleDragStart(e) {
            draggedPlayer = e.target;
            draggedPlayer.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedPlayer = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            if (!draggedPlayer) return;

            const court = document.getElementById('court');
            const rect = court.getBoundingClientRect();
            const chipSize = draggedPlayer.offsetWidth;
            const x = e.clientX - rect.left - (chipSize / 2);
            const y = e.clientY - rect.top - (chipSize / 2);

            // Constrain to court bounds
            const finalX = Math.max(0, Math.min(x, rect.width - chipSize));
            const finalY = Math.max(0, Math.min(y, rect.height - chipSize));

            draggedPlayer.style.left = finalX + 'px';
            draggedPlayer.style.top = finalY + 'px';

            // Update position record
            const playerId = draggedPlayer.id.replace('chip-', '');
            playerPositions[playerId].x = finalX;
            playerPositions[playerId].y = finalY;

            checkRotationFaults();
        }

        // Touch handlers for mobile
        let touchPlayer = null;
        let touchOffsetX = 0;
        let touchOffsetY = 0;

        function handleTouchStart(e) {
            e.preventDefault();
            touchPlayer = e.target;
            touchPlayer.classList.add('dragging');

            const touch = e.touches[0];
            const rect = touchPlayer.getBoundingClientRect();
            touchOffsetX = touch.clientX - rect.left;
            touchOffsetY = touch.clientY - rect.top;
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!touchPlayer) return;

            const touch = e.touches[0];
            const court = document.getElementById('court');
            const courtRect = court.getBoundingClientRect();
            const chipSize = touchPlayer.offsetWidth;

            const x = touch.clientX - courtRect.left - touchOffsetX;
            const y = touch.clientY - courtRect.top - touchOffsetY;

            // Constrain to court bounds
            const finalX = Math.max(0, Math.min(x, courtRect.width - chipSize));
            const finalY = Math.max(0, Math.min(y, courtRect.height - chipSize));

            touchPlayer.style.left = finalX + 'px';
            touchPlayer.style.top = finalY + 'px';
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            if (!touchPlayer) return;

            touchPlayer.classList.remove('dragging');

            // Update position record
            const playerId = touchPlayer.id.replace('chip-', '');
            playerPositions[playerId].x = parseFloat(touchPlayer.style.left);
            playerPositions[playerId].y = parseFloat(touchPlayer.style.top);

            touchPlayer = null;
            checkRotationFaults();
        }

        // Rotation functions
        function rotate(direction) {
            players.forEach(player => {
                if (direction === 'cw') {
                    player.zone = player.zone === 1 ? 6 : player.zone - 1;
                } else {
                    player.zone = player.zone === 6 ? 1 : player.zone + 1;
                }
            });
            snapToZones();
        }

        // Snap players to their zones
        function snapToZones() {
            const zones = document.querySelectorAll('.zone');

            players.forEach(player => {
                const chip = document.getElementById(`chip-${player.id}`);
                const targetZone = document.querySelector(`[data-zone="${player.zone}"]`);

                if (targetZone && chip) {
                    const zoneRect = targetZone.getBoundingClientRect();
                    const courtRect = document.getElementById('court').getBoundingClientRect();
                    const chipSize = chip.offsetWidth;

                    const x = (zoneRect.left - courtRect.left) + (zoneRect.width / 2) - (chipSize / 2);
                    const y = (zoneRect.top - courtRect.top) + (zoneRect.height / 2) - (chipSize / 2);

                    chip.style.left = x + 'px';
                    chip.style.top = y + 'px';

                    playerPositions[player.id].x = x;
                    playerPositions[player.id].y = y;
                }
            });

            checkRotationFaults();
        }

        // Reset to initial positions
        function resetPositions() {
            snapToZones();
        }

        // Toggle fullscreen
        function toggleFullscreen() {
            const elem = document.documentElement;
            const btn = document.getElementById('fullscreen-btn');

            if (!document.fullscreenElement) {
                if (elem.requestFullscreen) {
                    elem.requestFullscreen();
                } else if (elem.webkitRequestFullscreen) {
                    elem.webkitRequestFullscreen();
                } else if (elem.msRequestFullscreen) {
                    elem.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }

        // Update fullscreen button icon
        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
        document.addEventListener('msfullscreenchange', updateFullscreenButton);

        function updateFullscreenButton() {
            const btn = document.getElementById('fullscreen-btn');
            if (document.fullscreenElement) {
                btn.textContent = '⛶';
                btn.title = 'Verlaat volledig scherm';
            } else {
                btn.textContent = '⛶';
                btn.title = 'Volledig scherm';
            }
        }

        // Toggle rotation checking
        function toggleRotationCheck() {
            rotationCheckEnabled = document.getElementById('rotation-check').checked;
            checkRotationFaults();
        }

        // Preset functions
        function loadPresets() {
            const stored = localStorage.getItem('volleyball-presets');
            if (stored) {
                presets = JSON.parse(stored);
                updatePresetButtons();
            }
        }

        function savePresets() {
            localStorage.setItem('volleyball-presets', JSON.stringify(presets));
        }

        function savePreset(slot) {
            const state = {
                zones: {},
                positions: {}
            };

            players.forEach(player => {
                state.zones[player.id] = player.zone;
                const chip = document.getElementById(`chip-${player.id}`);
                state.positions[player.id] = {
                    x: parseFloat(chip.style.left),
                    y: parseFloat(chip.style.top)
                };
            });

            presets[slot] = state;
            savePresets();
            updatePresetButtons();

            // Visual feedback
            const btn = document.querySelector(`[data-slot="${slot}"]`);
            btn.classList.add('saving');
            setTimeout(() => btn.classList.remove('saving'), 500);
        }

        function loadPreset(slot) {
            const preset = presets[slot];
            if (!preset) return;

            // Restore zones and positions
            players.forEach(player => {
                player.zone = preset.zones[player.id];
                const chip = document.getElementById(`chip-${player.id}`);
                chip.style.left = preset.positions[player.id].x + 'px';
                chip.style.top = preset.positions[player.id].y + 'px';
                playerPositions[player.id] = { ...preset.positions[player.id] };
            });

            checkRotationFaults();
        }

        function updatePresetButtons() {
            presets.forEach((preset, index) => {
                const btn = document.querySelector(`[data-slot="${index}"]`);
                if (preset) {
                    btn.classList.add('filled');
                } else {
                    btn.classList.remove('filled');
                }
            });
        }

        function initPresetButtons() {
            const buttons = document.querySelectorAll('.preset-btn');

            buttons.forEach(btn => {
                const slot = parseInt(btn.dataset.slot);

                // Mouse events
                btn.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    pressTimer = setTimeout(() => {
                        savePreset(slot);
                        pressTimer = null;
                    }, 800);
                });

                btn.addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    if (pressTimer) {
                        clearTimeout(pressTimer);
                        pressTimer = null;
                        loadPreset(slot);
                    }
                });

                btn.addEventListener('mouseleave', () => {
                    if (pressTimer) {
                        clearTimeout(pressTimer);
                        pressTimer = null;
                    }
                });

                // Touch events
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    pressTimer = setTimeout(() => {
                        savePreset(slot);
                        pressTimer = null;
                    }, 800);
                });

                btn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (pressTimer) {
                        clearTimeout(pressTimer);
                        pressTimer = null;
                        loadPreset(slot);
                    }
                });

                btn.addEventListener('touchcancel', () => {
                    if (pressTimer) {
                        clearTimeout(pressTimer);
                        pressTimer = null;
                    }
                });
            });
        }

        // Check for rotation faults
        function checkRotationFaults() {
            // Clear previous fault highlights
            document.querySelectorAll('.player-chip').forEach(chip => {
                chip.classList.remove('fault');
            });

            // Skip checking if disabled
            if (!rotationCheckEnabled) return;

            // Get player positions for fault checking
            const positions = {};
            players.forEach(player => {
                const chip = document.getElementById(`chip-${player.id}`);
                positions[player.zone] = {
                    x: parseFloat(chip.style.left),
                    y: parseFloat(chip.style.top),
                    id: player.id
                };
            });

            // Check front row (4-3-2) alignment
            if (positions[4] && positions[3] && positions[4].x > positions[3].x) {
                document.getElementById(`chip-${positions[4].id}`).classList.add('fault');
                document.getElementById(`chip-${positions[3].id}`).classList.add('fault');
            }

            if (positions[3] && positions[2] && positions[3].x > positions[2].x) {
                document.getElementById(`chip-${positions[3].id}`).classList.add('fault');
                document.getElementById(`chip-${positions[2].id}`).classList.add('fault');
            }

            // Check back row (5-6-1) alignment
            if (positions[5] && positions[6] && positions[5].x > positions[6].x) {
                document.getElementById(`chip-${positions[5].id}`).classList.add('fault');
                document.getElementById(`chip-${positions[6].id}`).classList.add('fault');
            }

            if (positions[6] && positions[1] && positions[6].x > positions[1].x) {
                document.getElementById(`chip-${positions[6].id}`).classList.add('fault');
                document.getElementById(`chip-${positions[1].id}`).classList.add('fault');
            }

            // Check front-back alignment
            if (positions[4] && positions[5] && positions[4].y > positions[5].y) {
                document.getElementById(`chip-${positions[4].id}`).classList.add('fault');
                document.getElementById(`chip-${positions[5].id}`).classList.add('fault');
            }

            if (positions[3] && positions[6] && positions[3].y > positions[6].y) {
                document.getElementById(`chip-${positions[3].id}`).classList.add('fault');
                document.getElementById(`chip-${positions[6].id}`).classList.add('fault');
            }

            if (positions[2] && positions[1] && positions[2].y > positions[1].y) {
                document.getElementById(`chip-${positions[2].id}`).classList.add('fault');
                document.getElementById(`chip-${positions[1].id}`).classList.add('fault');
            }
        }

        // Initialize on load
        window.addEventListener('load', init);

        // Re-snap on window resize to maintain proper positions
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(snapToZones, 100);
        });
    </script>
</body>

</html>
